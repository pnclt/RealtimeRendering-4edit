# 第九章 基于物理的着色
在这个章节我们涵盖了对于基于物理的着色的各个方面。我们在第9.1节开始在描述光物质的物理交互，在第9.2到9.4节我们展示了这些物理如何联系到着色的过程。第9.5节到9.7节我们专门介绍了构建基于物理的着色模型和模型本身（涵盖了不同的材质类型，我们在第9.8到9.12节中进行了讨论。）。最后在9.13节中我们描述材质是怎样混合在一起的，并介绍了滤波方法来避免锯齿保证表面的表现。
## 9.1 物理灯光
光和物质的交互是基于物理的着色的基础，为了理解这些相互作用，他帮助我们对自然光有一个基本的认识。

在物理光学中，光被建模成一种电磁横向波，一种电场和磁场垂直与其传播方向的波。这个振动在这两个场上是解耦的，磁场和电场方向彼此垂直，并且他的比率是固定的。该比值等于相速度，我们稍后会讨论。

在图9.1中我们看到了一个简单的光波，事实上，它可能是最简单的正弦函数。这种波有一个波长，用希腊字母λ（lambda）表示。正如我们在第8.1节中看到的，光的颜色和波长有很密切的关系，由于这个原因，光是一个单一波长的光我们叫单色光，就是“单色”的意思。然而，在实践中我们遇到大多数光波都是多色的，他们都包含许多不同的波长。

![图9.1](image/figure9.1.png)

图9.1中的光波在另一方面是异常简单的。它是[线性偏振](https://baike.baidu.com/item/%E7%BA%BF%E5%81%8F%E6%8C%AF%E5%85%89/3064577)的。这意味着对于空间中固定的点，电场和磁场都沿着一条直线来回移动。相反，在这本书中，我们关注的是非偏振光。在非偏振光中，振动发生在垂直于传播方向上的任何方向上。尽管它们很简单，但是理解单色线性偏振波的行为是有用的，因为任何光都能分解成这些波的组合。

如果我们在波的某一特定相位(例如振幅峰值)上跟踪一段时间，我们会看到它在空间中以恒定的速度移动，这就是波的相速度。

在第8.1.1节中，我们讨论了可见光中，单一波长的大小大约在400-700纳米范围内。为了直观地了解这个长度，它大约是一根蜘蛛丝的一半到三分之一的宽度，而蛛丝本身还不到人类头发宽度的1/50。参见图9.2。在光学中，讨论特征相对于光波长的大小是很有用的。在这种情况下，我们可以说，一根蛛丝的宽度大约是2λ-3λ(2-3光波长)，一根头发的宽度大约是100λ-200λ。

光波携带能量。能量流的密度等于电场和磁场的大小的乘积，因为电场和磁场的大小是成比例的，和电场的平方成比例。我们关注电场，因为它对物质的影响比磁场强得多。在渲染中，我们关心的是随着时间的平均能量流，它与波振幅的平方成正比。这个平均能量流密度就是辐照度(irradiance)，用字母E表示。辐照度及其与其他光量的关系在第8.1.1节中讨论过。

![图9.2](image/figure9.2.png)

光波线性结合。总波是各分量波的总和。然而，由于辐照度与振幅的平方成正比，这似乎会导致一个悖论。例如，将两个相等的波相加不会导致“1 + 1 = 4”的辐照度情况吗?既然辐照度测量能量流，这不会违反能量守恒吗?这两个问题的答案分别是“有时”和“不”。

为了说明这一点，我们看一个简单的例子:$n$个单色波的叠加，除了相位外都是一样的。$n$个波的振幅是$a$。如前所述，每个波的辐照度$E_1$正比于$ a^2 $，或者换句话说，对于某个常数$k$, $ E_1 = ka^2 $

图9.3显示了这个案例的三个示例场景。在左边，所有的波都以相同的相位排列并相互加强。组合波的辐照度是单个波的$n^2$倍，比单个波的辐照度总和大$n$倍。这种情况称为相干干涉。中间的图，每一对波处于相反的相位，相互抵消。组合波的振幅为零，辐照度为零。这种情况就是相消干扰。

![图9.3](image/figure9.3.png)

相长干涉和相消干涉是相干叠加的两种特殊情况，即波峰和波谷以某种一致的方式排列在一起。根据相对相位关系，相干叠加$n$个相同的波可以产生一个光照度在0到$n^2$之间的波。

然而，通常情况下，当波相加时，它们是互不相干的，这意味着它们的相位是相对随机的。这在图9.3的右侧得到了说明。在这种情况下，组合波的振幅是$ \sqrt { n } a $，而单个波的辐照度线性加起来是单个波辐照度的$n$倍，正如我们所期望的那样。

看起来，相消干涉和相长干涉违反了能量守恒。但是图9.3没有显示全图-它只显示了一个位置的波的相互作用。当波在空间中传播时，它们之间的相位关系从一个位置变化到另一个位置，如图9.4所示。在某些位置，波的干涉是累加的，并且组合波的辐照度大于各波辐照度值的总和。在其他位置，它们进行破坏性干扰，使组合的辐照度小于各波辐照度值的总和。这并不违反能量守恒定律，因为由相长干涉获得的能量和由相消干涉损失的能量总是相互抵消的

![图9.4](image/figure9.4.png)

当物体中的电荷振荡时就会发射出光波。引起振动的部分能量——热能、电能、化学能——被转换成光能，然后辐射到远离物体的地方。在渲染中，这些物体被当作光源处理。我们在第5.2节中首先讨论了光源，在第10章中将从更物理的角度对它们进行描述。

在光波被发射出来之后，它们在空间中传播，直到它们遇到一些可以相互作用的物质。大多数光物质相互作用背后的核心现象很简单，与上面讨论的发射情况非常相似。振荡的电场推动和拉动物质中的电荷，使它们依次振荡。振荡的电荷发出新的光波，将入射光波的部分能量重新定向到新的方向。这种反应称为散射，是各种光学现象的基础。

散射光波与原始光波具有相同的频率。通常情况下，当原始波包含光的多个频率时，每一个频率都单独与物质相互作用。一个频率的入射光能不会对不同频率的出射光能做出贡献，除了一些特定的——相对罕见的情况，如荧光和磷光，我们将不在本书中描述。

一个孤立的分子向各个方向散射光，有些方向上的散射强度有一定的变化。更多的光在靠近源传播轴的方向上散射，包括向前和向后。这种分子作为散射体的散射效果——即其附近的光波被散射的可能性——因波长的不同而有强烈的变化。短波长的光比长波长的光更有效地散射。

在渲染中，我们关心的是许多分子的集合。光与这些聚集体的相互作用与孤立分子的相互作用不一定相似。从附近分子散射出来的波往往是相互相干的，因此会产生干涉，因为它们来自同一个入射波。本节的其余部分将专门讨论多个分子光散射的几个重要的特殊情况。

### 9.1.1 粒子